# Mac上でグローバルIPFSを構築してベンチマークを行う方法

## 概要
このドキュメントでは、Mac上でグローバルなIPFSノードを構築し、ベンチマークを実行する方法について議論します。

## 実現可能性

**結論: 可能です**

Mac上でグローバルIPFSのベンチマークを行うことは十分可能です。以下の方法があります：

### 方法1: ネイティブIPFSのインストール
- Homebrewを使用してIPFSをインストール
- ローカルマシンで直接IPFSデーモンを実行
- 実際のグローバルIPFSネットワークに接続

### 方法2: Dockerを使用したIPFS環境
- 既存のDocker環境を活用（プロジェクト内に既に存在）
- 複数のIPFSノードをシミュレート
- ネットワーク条件の制御が容易

## アプローチの比較

### ネイティブIPFS（グローバルネットワーク接続）

**メリット:**
- 実際のIPFSネットワークの状況を反映
- 真のピアツーピア通信をテスト
- DHT（分散ハッシュテーブル）の実際の動作を確認

**デメリット:**
- ネットワーク条件が外部要因に依存（不安定）
- 再現性のあるベンチマークが困難
- ファイアウォール/NATの設定が必要な場合がある
- 帯域幅の制限が困難

### Docker環境（ローカルシミュレーション）

**メリット:**
- 制御された環境でのテスト
- 再現性が高い
- ネットワーク帯域幅の制限が可能
- 複数ノードのシミュレーションが容易

**デメリット:**
- 実際のグローバルネットワークとは異なる
- Docker オーバーヘッドの影響

## 推奨アプローチ

### ハイブリッド方式
以下の組み合わせを推奨します：

1. **ローカルベンチマーク** (既存のDocker環境)
   - 基本的な性能測定
   - ネットワーク制限下での動作確認
   - 開発・デバッグ

2. **グローバルIPFS接続テスト** (ネイティブまたはDocker)
   - 実際のネットワーク環境での性能測定
   - エンドツーエンドの遅延測定
   - パブリックゲートウェイとの比較

## 実装手順

### Step 1: ネイティブIPFSのセットアップ

```bash
# Homebrewでインストール
brew install ipfs

# IPFSリポジトリの初期化
ipfs init

# デーモンの起動
ipfs daemon
```

### Step 2: グローバルネットワークへの接続確認

```bash
# ピア接続の確認
ipfs swarm peers

# パブリックファイルの取得テスト
ipfs cat /ipfs/QmQPeNsJPyVWPFDVHb77w8G42Fvo15z4bG2X8D2GhfbSXc/readme
```

### Step 3: ベンチマークの実装

必要な機能：
- ファイルのアップロード時間測定
- ファイルのダウンロード時間測定
- 複数ノードからの並行アクセステスト
- ネットワーク帯域幅の影響測定

### Step 4: Dockerとネイティブの連携

Dockerコンテナ内のIPFSノードとMac上のネイティブIPFSノードを接続することも可能：

```yaml
# docker-compose.ymlの例
services:
  ipfs-node:
    image: ipfs/go-ipfs:latest
    ports:
      - "4001:4001"  # Swarm
      - "5001:5001"  # API
      - "8080:8080"  # Gateway
    volumes:
      - ./data/ipfs:/data/ipfs
```

## ベンチマーク項目

### 基本性能
- [ ] ファイルアップロード速度（サイズ別）
- [ ] ファイルダウンロード速度（サイズ別）
- [ ] DHT検索時間
- [ ] ピア発見時間

### スケーラビリティ
- [ ] 同時接続ノード数の影響
- [ ] ファイル数の影響
- [ ] ネットワーク帯域幅制限下での性能

### 比較テスト
- [ ] ローカルネットワーク vs グローバルIPFS
- [ ] プライベートネットワーク vs パブリックネットワーク
- [ ] 暗号化あり vs なし

## 既存プロジェクトとの統合

このプロジェクトには既に以下のリソースがあります：

- `main.go`: ベンチマークロジック
- `docker-compose.yml`: Docker環境設定
- `analyze_results.py`: 結果分析スクリプト
- `visualize_results.py`: 可視化スクリプト

これらを拡張して、グローバルIPFSベンチマークを追加できます。

## 次のステップ

1. **要件の明確化**
   - どのような性能指標を測定したいか？
   - グローバルIPFSで具体的に何をテストしたいか？
   - 比較対象は何か？（ローカル vs グローバル、暗号化あり vs なし等）

2. **環境の選択**
   - ネイティブIPFSを使用するか？
   - Dockerで複数ノードをシミュレートするか？
   - 両方を組み合わせるか？

3. **実装計画**
   - 既存のベンチマークコードの拡張
   - 新しいテストシナリオの追加
   - 結果の分析・可視化方法

## 質問と検討事項

- 何を測定したいですか？（レイテンシ、スループット、スケーラビリティ等）
- 実際のグローバルIPFSネットワークに接続する必要がありますか？
- それとも、複数のノードをローカルでシミュレートすれば十分ですか？
- 暗号化されたIPFSの性能も測定しますか？
- 既存のDocker環境を活用しますか？それとも新しい環境を構築しますか？
