# GCP マシンタイプ比較（コスト重視）

## 1 vCPU マシンタイプ

### e2-micro（最安！）

**スペック:**
- vCPU: 0.25-2（共有、バースト可能）
- メモリ: 1 GB
- 無料枠: 月730時間（1台分）✨

**料金（東京リージョン）:**
- オンデマンド: $0.0084/時間
- プリエンプティブ: $0.0025/時間

**8時間 × 4台:**
- オンデマンド: $0.27
- プリエンプティブ: $0.08

**問題点:**
- メモリが1GBしかない（IPFS + Docker には不足）
- 共有CPU（他のユーザーと共有）
- ベンチマークには不向き

### e2-small

**スペック:**
- vCPU: 0.5-2（共有、バースト可能）
- メモリ: 2 GB

**料金（東京リージョン）:**
- オンデマンド: $0.0168/時間
- プリエンプティブ: $0.0050/時間

**8時間 × 4台:**
- オンデマンド: $0.54
- プリエンプティブ: $0.16

**問題点:**
- まだメモリが少ない（IPFS + Docker で厳しい）
- 共有CPU

### e2-medium

**スペック:**
- vCPU: 1-2（共有、バースト可能）
- メモリ: 4 GB

**料金（東京リージョン）:**
- オンデマンド: $0.0336/時間
- プリエンプティブ: $0.0101/時間

**8時間 × 4台:**
- オンデマンド: $1.08
- プリエンプティブ: $0.32

**評価:**
- メモリ4GB（IPFS + Dockerで動作可能）
- 共有CPUだが実用的
- **コスパ良い！** ⭐⭐⭐⭐

### e2-standard-2（現在の推奨）

**スペック:**
- vCPU: 2（専有）
- メモリ: 8 GB

**料金（東京リージョン）:**
- オンデマンド: $0.0670/時間
- プリエンプティブ: $0.0201/時間

**8時間 × 4台:**
- オンデマンド: $2.14
- プリエンプティブ: $0.64

**評価:**
- 専有CPU（安定）
- メモリ8GB（十分）
- ベンチマークに最適 ⭐⭐⭐⭐⭐

## コスト比較（8時間、4ノード、プリエンプティブ）

| マシンタイプ | vCPU | メモリ | インスタンス代 | ディスク | ネットワーク | **合計** | IPFS適性 |
|-------------|------|--------|--------------|---------|-------------|---------|---------|
| e2-micro | 0.25-2共有 | 1 GB | $0.08 | $0.16 | $6.00 | **$6.24** | ❌ メモリ不足 |
| e2-small | 0.5-2共有 | 2 GB | $0.16 | $0.16 | $6.00 | **$6.32** | ⚠️ メモリギリギリ |
| **e2-medium** | **1-2共有** | **4 GB** | **$0.32** | **$0.16** | **$6.00** | **$6.48** | ✅ **推奨** ⭐ |
| e2-standard-2 | 2専有 | 8 GB | $0.64 | $0.16 | $6.00 | **$6.80** | ✅ 安定 |
| n1-standard-2 | 2専有 | 7.5 GB | $0.64 | $0.16 | $6.00 | **$6.80** | ✅ 安定 |

**削減額（e2-standard-2 → e2-medium）:**
```
$6.80 - $6.48 = $0.32（約 ¥48）
```

## 推奨: e2-medium

### メリット

1. **コスト削減**
   - インスタンス代: $0.64 → $0.32（半額！）
   - 合計: 約 ¥50 削減

2. **十分なスペック**
   - メモリ4GB（IPFS + Docker で動作可能）
   - vCPU 1-2（バースト可能）

3. **IPFS ノードに適している**
   - IPFSはそこまでCPU負荷が高くない
   - ネットワークI/O重視
   - メモリ4GBあれば十分

### デメリット

1. **共有CPU（Shared-core）**
   - 他のユーザーと物理CPUを共有
   - 負荷が高い時にパフォーマンスが落ちる可能性
   - ただしベンチマークには影響少ない

2. **バースト制限**
   - 継続的に高負荷をかけると制限される
   - 短時間のベンチマークなら問題なし

## 共有CPU vs 専有CPU

### 共有CPU（e2-micro, e2-small, e2-medium）

**仕組み:**
```
物理CPU
├── あなたのVM（25%）
├── 他人のVM（25%）
├── 他人のVM（25%）
└── 他人のVM（25%）
```

**特徴:**
- 安い
- バースト可能（短時間なら100%使える）
- 長時間高負荷だと制限される

**向いている用途:**
- Webサーバー（断続的な負荷）
- 開発環境
- 軽いバッチ処理
- **短時間ベンチマーク** ← 今回これ！

### 専有CPU（e2-standard, n1-standard, n2-standard）

**仕組み:**
```
物理CPU
└── あなたのVM（100%専有）
```

**特徴:**
- 高い
- 常に安定したパフォーマンス
- 他のユーザーの影響を受けない

**向いている用途:**
- 本番環境
- 長時間の高負荷処理
- 性能の安定性が重要な場合

## IPFSベンチマークでの推奨

### 最安: e2-medium（推奨）⭐

```hcl
machine_type = "e2-medium"
use_preemptible = true
```

**理由:**
1. コスト: 約 ¥970（¥50削減）
2. メモリ4GB（IPFS + Docker で動作）
3. 短時間ベンチマークなら共有CPUで十分
4. IPFSはネットワークI/O重視（CPU負荷は低め）

**8時間コスト:**
```
インスタンス: $0.32
ディスク:     $0.16
ネットワーク: $6.00
──────────────────
合計:         $6.48 ≈ ¥970
```

### 安定重視: e2-standard-2

```hcl
machine_type = "e2-standard-2"
use_preemptible = true
```

**理由:**
1. 専有CPU（安定）
2. メモリ8GB（余裕）
3. ベンチマーク結果の信頼性が高い

**8時間コスト:**
```
合計: $6.80 ≈ ¥1,020
```

## さらに安く: e2-small は？

### e2-small のテスト

**スペック:**
- vCPU: 0.5-2（共有）
- メモリ: 2 GB

**問題:**
- メモリ2GBは厳しい
- Docker + IPFS + OS で使い切る可能性
- スワップが発生すると激遅

**判定:** ⚠️ リスクあり

**コスト削減額:**
```
e2-medium: $6.48
e2-small:  $6.32
差額:      $0.16（約 ¥24）
```

たった¥24のためにリスクを取る価値は低い。

## 実験: もっと安くしたい場合

### オプション1: ノード数を減らす

```hcl
node_count = 2  # 4台 → 2台
machine_type = "e2-medium"
```

**コスト（8時間）:**
```
インスタンス: $0.16
ディスク:     $0.08
ネットワーク: $3.00
──────────────────
合計:         $3.24 ≈ ¥486
```

**半額！**

### オプション2: ディスクサイズを減らす

```hcl
disk_size_gb = 10  # 30GB → 10GB
```

**削減額:**
```
30GB: $0.16
10GB: $0.05
差額: $0.11（約 ¥17）
```

効果は小さい。

### オプション3: us-central1 リージョンを使う

```hcl
region = "us-central1"
zone   = "us-central1-a"
machine_type = "e2-medium"
```

**料金（アイオワ）:**
- e2-medium プリエンプティブ: $0.0075/時間（東京の約75%）

**8時間 × 4台:**
```
インスタンス: $0.24（東京より$0.08安い）
```

**注意:**
- レイテンシが高くなる（日本から遠い）
- ベンチマーク結果に影響

## 最終推奨

### ベストバランス: e2-medium

```hcl
project_id = "research-383706"
node_count = 4
machine_type = "e2-medium"  # ← これ！
use_preemptible = true
disk_size_gb = 30
```

**8時間コスト: 約 ¥970**

### 安定重視: e2-standard-2

```hcl
machine_type = "e2-standard-2"
```

**8時間コスト: 約 ¥1,020**

### 最安: e2-medium + 2ノード

```hcl
node_count = 2
machine_type = "e2-medium"
```

**8時間コスト: 約 ¥486**

## まとめ

| 設定 | vCPU | メモリ | コスト | 削減額 | 推奨度 |
|------|------|--------|--------|--------|--------|
| **e2-medium + 4ノード** | **1-2共有** | **4GB** | **¥970** | **-¥50** | ⭐⭐⭐⭐⭐ |
| e2-standard-2 + 4ノード | 2専有 | 8GB | ¥1,020 | - | ⭐⭐⭐⭐ |
| e2-medium + 2ノード | 1-2共有 | 4GB | ¥486 | -¥534 | ⭐⭐⭐ |
| e2-small + 4ノード | 0.5-2共有 | 2GB | ¥948 | -¥72 | ⚠️ リスク |

**推奨: e2-medium（1-2 vCPU共有、4GB）**
- 十分なスペック
- コスト削減（約¥50）
- IPFSベンチマークに最適

変更しますか？
